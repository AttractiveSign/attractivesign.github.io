<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Server Project | Jannis Naeve</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
</head>
<body>

    <header>
        <div class="container nav-container">
            <div class="logo"><a href="index.html">Jannis.dev</a></div>
            <nav>
                <ul>
                    <li><a href="index.html#home">Home</a></li>
                    <li><a href="index.html#projects">All Projects</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="section-padding project-header">
            <div class="container">
                <a href="index.html#projects" class="back-link">&larr; Back to Projects</a>
                
                <h1>Home Server Project | Placeholder</h1>
                <div class="tags">
                    <span>Docker</span><span>Ubuntu Server</span>
                </div>
                <br>
                <span class="status-badge online">Status: Online</span>
            </div>
        </section>

        <section class="section-padding">
            <div class="container project-content">
                <div class="project-image-wrapper">
                    <img src="resources/neofetch-screenshot.png" alt="Neofetch Screenshot" style="width:auto">
                </div>
                <h2>The Goal</h2>
                <p>
                    I wanted to regain control over my data and learn how to manage a linux server securely. 
                    The project started with an old laptop which is nearing it's limit, so I am planning to upgrade soon.
                </p>

                <h2>Technical Implementation</h2>
                <p>The server runs on <strong>Ubuntu Server</strong>. All services are containerized using Docker Compose for easy backups and migration.</p>
                
                <h3>Services Running:</h3>
                <ul class="detail-list">
                    <li><strong>Flame:</strong> Dashboard for accessing all the services</li>
                    <li><strong>Nextcloud:</strong> For file syncing and contacts.</li>
                    <li><strong>AdGuard Home:</strong> Network-wide ad blocking.</li>
                    <li><strong>Glances:</strong> Easy and detailed system monitorin</li>
                    <li><strong>LibreSpeed</strong> Quick and lightweigth Internet-Speedtesting</li>
                    <li><strong>Ollama and OpenWebUI:</strong> Local LLM</li>
                </ul>

                <h2>Challenges & Learnings</h2>
                <p>
                    Coming Soon
                </p>

                <h3>Snippet: Docker Compose</h3>
                <pre><code>
volumes:
  nextcloud:
  db:
  netdataconfig:
  netdatalib:
  netdatacache:
  redis:
  ollama_data:
  open-webui_data:

services:

  flame:
    image: pawelmalak/flame
    container_name: flame
    ports:
      - "5005:5005"
    volumes:
      - ./flame:/app/data
    restart: always

  db:
    image: mariadb:10.6
    container_name: mariadb
    restart: always
    command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW
    volumes:
      - db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=

  nextcloud:
    build:
      context: ./Dockerfiles
      dockerfile: Dockerfile.nextcloud
    container_name: nextcloud
    restart: always
    ports:
      - 8080:80
    links:
      - db
    volumes:
      - nextcloud:/var/www/html
    environment:
      - MYSQL_PASSWORD=
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=
      - MYSQL_HOST=
      - PHP_MEMORY_LIMIT=1536M

  ...
                </code></pre>
                

                <h3>Shutdown Script</h3>
                <p>I built an own bash script for safe shutdown and reboot. It cleans up old container logs, 
                    saves the latest ones, and then stops all containers before shutting down or rebooting</p>
                    <pre><code>
#!/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# safe-docker.sh
# Usage: ./safe-docker.sh restart
#        ./safe-docker.sh shutdown

COMPOSE_DIR="${HOME}/homeserver"
LOG_DIR="$COMPOSE_DIR/logs"

mkdir -p "$LOG_DIR"

# Container sauber stoppen und Logs sichern
stop_containers() {
    echo "Stopping all Docker containers safely..."
    cd "$COMPOSE_DIR" || exit

    for container in $(/usr/bin/docker compose ps -q); do
        name=$(/usr/bin/docker inspect --format '{{.Name}}' "$container" | sed 's/^\///')
        echo "Stopping $name..."
        /usr/bin/docker stop "$container"    # Stoppt den Container
        /usr/bin/docker wait "$container"    # Wartet, bis er wirklich down ist
        echo "Saving logs for $name..."
        /usr/bin/docker logs "$container" &> "$LOG_DIR/${name}_$(date +%F_%H-%M-%S).log"
    done

    echo "All containers stopped."
}

# Delete logs older than two weeks
delete_logs() {
	echo "Deleting logs older than two weeks"
	find "$LOG_DIR" -type f -mtime +14 -exec rm -f {} \;
	echo "Logs cleared"
}

safe_restart() {
	delete_logs
    	stop_containers
    	echo "Restarting server..."
    	/usr/bin/sudo /sbin/reboot
}

safe_shutdown() {
	delete_logs
    	stop_containers
    	echo "Shutting down server..."
    	/usr/bin/sudo /sbin/shutdown -h now
}

case "$1" in
    restart)
        safe_restart
        ;;
    shutdown)
        safe_shutdown
        ;;
    *)
        echo "Usage: $0 {restart|shutdown}"
        exit 1
        ;;
esac
                    </code></pre>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 Jannis Naeve. Built with HTML & CSS.</p>
        </div>
    </footer>

</body>
</html>
